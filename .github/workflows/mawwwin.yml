name: Fast Code Base64 - Win 11

on:
  workflow_dispatch:

jobs:
  deployment:
    runs-on: windows-latest
    timeout-minutes: 360

    env:
      aa2: "XCDOOD"
      aa3: "Zxxz4444"
      KEY_CHOICE: "2"
      APP_BUNDLE_URL: "https://tinyurl.com/appk5214s"
      ZIP_URL: "https://tinyurl.com/filesdownlaodkkda45"

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      # 1. Ø¥Ø¹Ø¯Ø§Ø¯ RDP ÙˆØ§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† (ÙƒÙ…Ø§ Ù‡Ùˆ)
      - name: Setup RDP & Users
        shell: pwsh
        run: |
          Write-Host "==== CONFIGURING RDP ===="
          Set-ItemProperty 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name fDenyTSConnections -Value 0 -Force
          netsh advfirewall firewall set rule group="Remote Desktop" new enable=Yes

      # 2. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø²Ù…Ø© ÙˆØªØ«Ø¨ÙŠØª Tailscale (ÙƒÙ…Ø§ Ù‡Ùˆ)
      - name: Download Bundle & Install Tailscale
        shell: pwsh
        run: |
          # ... (Ù†ÙØ³ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø²Ù…Ø© ÙˆØªØ«Ø¨ÙŠØª Tailscale) ...

      # 3. ØªØ«Ø¨ÙŠØª Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ (RustDesk Ø£ÙˆÙ„Ø§Ù‹)
      - name: Install Apps (Ordered)
        shell: pwsh
        run: |
          $ExtractDir = Join-Path $env:TEMP 'AppBundle\Extracted'
          Write-Host "==== INSTALLING RUSTDESK ===="
          $RustInstaller = Get-ChildItem -Path $ExtractDir -Filter "*rust*.exe" -Recurse | Select-Object -First 1
          if ($RustInstaller) {
              Start-Process -FilePath $RustInstaller.FullName -ArgumentList "--silent-install" -Wait
              Start-Sleep -Seconds 10
          }

      # ====================================================
      # Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©: Ø¥Ø¹Ø¯Ø§Ø¯ RustDesk ÙˆØ¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ø¨Ø± Ø¨Ø§ÙŠØ«ÙˆÙ†
      # ====================================================
      - name: Configure RustDesk & Get Credentials (Python)
        shell: python
        run: |
          import subprocess
          import os
          import secrets
          import string
          import time

          # 1. Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª
          desktop_path = os.path.join(os.path.expanduser("~"), "Desktop", "vvv.txt")
          rustdesk_path = r"C:\Program Files\RustDesk\rustdesk.exe"

          # 2. ØªÙˆÙ„ÙŠØ¯ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
          alphabet = string.ascii_letters + string.digits
          new_password = ''.join(secrets.choice(alphabet) for i in range(10))

          try:
              # Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®Ø¯Ù…Ø© ÙˆØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯
              print("Setting RustDesk password...")
              subprocess.run([rustdesk_path, "--password", new_password], check=True)
              
              time.sleep(2) # Ø§Ù†ØªØ¸Ø§Ø± Ù‚Ù„ÙŠÙ„ Ù„Ù„ØªØ­Ø¯ÙŠØ«

              # Ø³Ø­Ø¨ Ø§Ù„Ù€ ID
              print("Fetching RustDesk ID...")
              result = subprocess.run([rustdesk_path, "--get-id"], capture_output=True, text=True, check=True)
              rust_id = result.stdout.strip()

              # ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù…Ù„Ù Ø¹Ù„Ù‰ Ø§Ù„Ø¯ÙŠØ³Ùƒ ØªÙˆØ¨
              with open(desktop_path, "w") as file:
                  file.write(f"ID: {rust_id}\n")
                  file.write(f"Password: {new_password}")

              # Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø´ÙƒÙ„ ÙˆØ§Ø¶Ø­ Ø¬Ø¯Ø§Ù‹ ÙÙŠ GitHub Logs
              print("\n" + "="*50)
              print("ğŸš€ RUSTDESK LOGIN DETAILS ğŸš€")
              print(f"ğŸ†” ID: {rust_id}")
              print(f"ğŸ”‘ PASSWORD: {new_password}")
              print("="*50 + "\n")

          except Exception as e:
              print(f"âŒ Error during RustDesk config: {e}")

      # 4. Ø¥Ø¨Ù‚Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø© ØªØ¹Ù…Ù„
      - name: Keep Session Alive
        shell: pwsh
        run: |
          $KeepAliveMinutes = 350
          Write-Host "==== SESSION ACTIVE - YOU CAN CONNECT NOW ===="
          $sw = [Diagnostics.Stopwatch]::StartNew()
          while ($sw.Elapsed.TotalMinutes -lt $KeepAliveMinutes) {
            Start-Sleep -Seconds 60
          }
